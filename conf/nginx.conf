user  www www;

worker_processes auto;

error_log  /home/wwwlogs/nginx_error.log  crit;

pid        /usr/local/nginx/logs/nginx.pid;

#Specifies the value for maximum file descriptors that can be opened by this process.
worker_rlimit_nofile 51200;

events
    {
        use epoll;
        worker_connections 51200;
        multi_accept on;
    }

http
    {
        include       mime.types;
        default_type  application/octet-stream;

        server_names_hash_bucket_size 128;
        client_header_buffer_size 32k;
        large_client_header_buffers 4 32k;
        client_max_body_size 50m;

        sendfile   on;
        tcp_nopush on;

        keepalive_timeout 60;

        tcp_nodelay on;

        fastcgi_connect_timeout 300;
        fastcgi_send_timeout 300;
        fastcgi_read_timeout 300;
        fastcgi_buffer_size 64k;
        fastcgi_buffers 4 64k;
        fastcgi_busy_buffers_size 128k;
        fastcgi_temp_file_write_size 256k;

        gzip on;
        gzip_min_length  1k;
        gzip_buffers     4 16k;
        gzip_http_version 1.1;
        gzip_comp_level 2;
        gzip_types     text/plain application/javascript application/x-javascript text/javascript text/css application/xml application/xml+rss;
        gzip_vary on;
        gzip_proxied   expired no-cache no-store private auth;
        gzip_disable   "MSIE [1-6]\.";

        #limit_conn_zone $binary_remote_addr zone=perip:10m;
        ##If enable limit_conn_zone,add "limit_conn perip 10;" to server section.

        server_tokens off;
        #log format
        log_format  access  '$remote_addr - $remote_user [$time_local] "$request" '
             '$status $body_bytes_sent "$http_referer" '
             '"$http_user_agent" $http_x_forwarded_for';
		access_log off;

server
    {
        listen 80 default_server;
        #listen [::]:80 default_server ipv6only=on;
        #server_name www.lnmp.org;
	server_name www.mconcepts.cn mconcepts.cn 120.27.33.222;

        index index.html index.htm index.php;
        root  /home/www/ydyx_com;

        #error_page   404   /404.html;
        include enable-php.conf;

                location / {
                   ssi on;
                   ssi_silent_errors on;
                   ssi_types text/shtml;
		if (-e $request_filename) {
                       break;
               }
               if (!-e $request_filename) {
                       rewrite ^/(.*)$ /index.php/$1 last;
                       break;
               }
                 }

        location /nginx_status
        {
            stub_status on;
            access_log   off;
        }

        location ~ .*\.(gif|jpg|jpeg|png|bmp|swf)$
        {
            expires      30d;
        }

        location ~ .*\.(js|css)?$
        {
            expires      12h;
        }

        location ~ /\.
        {
            deny all;
        }

        access_log  /home/wwwlogs/access.log  access;


#if (!-e $request_filename) {
#          rewrite ^/(.*)$ /index.php$1 last;
#       }
#rewrite ^/news  /index.php?m=content&c=index&a=lists&catid=10 last;
#rewrite ^/news/company /index.php?m=content&c=index&a=lists&catid=11 last;
#rewrite ^/news/company/1234.html /index.php?m=content&c=index&a=show&catid=11&id=77 last;
#rewrite ^/news/expert /index.php?m=content&c=index&a=lists&catid=12 last;
#rewrite ^/news/expert/123.html /index.php?m=content&c=index&a=show&catid=12&id=75 last;
#rewrite ^/news/sci-tech /index.php?m=content&c=index&a=lists&catid=13 last;
#rewrite ^/news/sci-tech/123.html /index.php?m=content&c=index&a=show&catid=13&id=76 last;
#rewrite ^/news/sci-tech/123.html /index.php?m=content&c=index&a=show&catid=13&id=76 last;
#rewrite ^/info /index.php?m=content&c=index&a=lists&catid=19 last;
#rewrite ^/info/tech /index.php?m=content&c=index&a=lists&catid=20 last;
#rewrite ^/info/tech/123.html /index.php?m=content&c=index&a=show&catid=20&id=96 last;
#rewrite ^/info/case /index.php?m=content&c=index&a=lists&catid=21 last;
#rewrite ^/info/case/123.html /index.php?m=content&c=index&a=show&catid=21&id=97 last;
#rewrite ^/info/event /index.php?m=content&c=index&a=lists&catid=22 last;
#rewrite ^/info/event /index.php?m=content&c=index&a=lists&catid=22 last;
#rewrite ^/info/event/123.html /index.php?m=content&c=index&a=show&catid=22&id=19 last;
#rewrite ^/baike /index.php?m=content&c=index&a=lists&catid=23 last;
#rewrite ^/baike/123.html /index.php?m=content&c=index&a=show&catid=23&id=56 last;
#rewrite ^/academy /index.php?m=content&c=index&a=lists&catid=29 last;
#rewrite ^/academy/about /index.php?m=content&c=index&a=lists&catid=30 last;
#rewrite ^/academy/course /index.php?m=content&c=index&a=lists&catid=31 last;
#rewrite ^/academy/certify /index.php?m=content&c=index&a=lists&catid=32 last;
#rewrite ^/academy/show /index.php?m=content&c=index&a=lists&catid=33 last;
#rewrite ^/association /index.php?m=content&c=index&a=lists&catid=34 last;
    }


server
    {
        listen 80;
        server_name exam.mconcepts.cn;
        index index.html index.htm index.php;
        root  /home/www/phpems;

        #error_page   404   /404.html;
        include enable-php.conf;

        location /nginx_status
        {
            stub_status on;
            access_log   off;
        }

        location ~ .*\.(gif|jpg|jpeg|png|bmp|swf)$
        {
            expires      30d;
        }

        location ~ .*\.(js|css)?$
        {
            expires      12h;
        }

        location ~ /\.
        {
            deny all;
        }

        access_log  /home/wwwlogs/access.log  access;
    }


server
    {
        listen 80;
        server_name yun.mconcepts.cn;
        index index.html index.htm index.php;
        root  /home/www/weixin;

        #error_page   404   /404.html;
        include enable-php.conf;

        location /nginx_status
        {
            stub_status on;
            access_log   off;
        }

        location ~ .*\.(gif|jpg|jpeg|png|bmp|swf)$
        {
            expires      30d;
        }

        location ~ .*\.(js|css)?$
        {
            expires      12h;
        }

        location ~ /\.
        {
            deny all;
        }

        access_log  /home/wwwlogs/weixinaccess.log  access;
    }
    server {
        listen       80;
        server_name  e.mconcepts.cn;
        root   /usr/local/tomcat/webapps;
				index  marketing/phone_marketing/login.html;

        location / {
           ssi on;
           ssi_silent_errors on;
           ssi_types text/shtml;
					 if (-e $request_filename) {
                   break;
           }
           if (!-e $request_filename) {
                   rewrite ^/(.*)$ /index.php/$1 last;
                   break;
           }

        }
        
        location /nginx_status
        {
            stub_status on;
            access_log   off;
        }
        
				location ~ .*\.(jsp|action|do)$ {
	        index index.jsp;
	        proxy_pass http://127.0.0.1:8080;   #来自jsp请求交给tomcat处理
	        proxy_redirect off;
	        proxy_set_header Host $host;    #后端的Web服务器可以通过X-Forwarded-For获取用户真实IP
	        proxy_set_header X-Real-IP $remote_addr;
	        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
	        client_max_body_size 10m;   #允许客户端请求的最大单文件字节数
	        client_body_buffer_size 128k; #缓冲区代理缓冲用户端请求的最大字节数
	        proxy_connect_timeout 90;   #nginx跟后端服务器连接超时时间(代理连接超时)
	        proxy_read_timeout 90;      #连接成功后，后端服务器响应时间(代理接收超时)
	        proxy_buffer_size 4k;       #设置代理服务器（nginx）保存用户头信息的缓冲区大小
	        proxy_buffers 6 32k;        #proxy_buffers缓冲区，网页平均在32k以下的话，这样设置
	        proxy_busy_buffers_size 64k;#高负荷下缓冲大小（proxy_buffers*2）
	        proxy_temp_file_write_size 64k; #设定缓存文件夹大小，大于这个值，将从upstream服务器传
        }
        location ~ .*\.(gif|jpg|jpeg|png|bmp|swf)$   #由nginx处理静态页面
        {
        	expires 30d;   #使用expires缓存模块，缓存到客户端30天
        }
        

        location ~ .*\.(js|css)$
        {
        	expires 12h;
        }
        
        location ~ /\.
        {
            deny all;
        }

        access_log  /home/wwwlogs/tomcat_marketing.log  access;
    }

server
    {
        listen 80;
        server_name test.mconcepts.cn;
        index index.html index.htm index.php;
        root  /home/www/ydyx_com_test;

        #error_page   404   /404.html;
        include enable-php.conf;

        location /nginx_status
        {
            stub_status on;
            access_log   off;
        }

        location ~ .*\.(gif|jpg|jpeg|png|bmp|swf)$
        {
            expires      30d;
        }

        location ~ .*\.(js|css)?$
        {
           expires      12h;
        }

        location ~ /\.
        {
            deny all;
        }

       access_log  /home/wwwlogs/ydyx_com_test.log  access;
    }


include vhost/*.conf;
}

